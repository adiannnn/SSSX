<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据流程测试工具</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }
        h2 {
            color: #555;
            margin-top: 0;
        }
        button {
            padding: 10px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        button:hover {
            background-color: #45a049;
        }
        .secondary-btn {
            background-color: #6c757d;
        }
        .secondary-btn:hover {
            background-color: #5a6268;
        }
        .warning-btn {
            background-color: #ff9800;
        }
        .warning-btn:hover {
            background-color: #e68900;
        }
        .danger-btn {
            background-color: #f44336;
        }
        .danger-btn:hover {
            background-color: #d32f2f;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background-color: #e8f5e9;
            border-left: 4px solid #4CAF50;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
        }
        .data-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .data-column {
            width: 48%;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-success {
            background-color: #4CAF50;
        }
        .status-warning {
            background-color: #ff9800;
        }
        .status-error {
            background-color: #f44336;
        }
        pre {
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
        }
        .status-message {
            font-size: 14px;
            padding: 8px 12px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .message-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4CAF50;
        }
        .message-warning {
            background-color: #fff3e0;
            color: #e65100;
            border-left: 4px solid #ff9800;
        }
        .message-error {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>数据流程测试工具</h1>
        
        <div class="test-section">
            <h2>1. 数据检查</h2>
            <button id="checkDataFlow">检查数据流程状态</button>
            <div id="dataFlowStatus" class="result" style="display: none;">
                <div id="statusMessages"></div>
                <div class="data-display">
                    <div class="data-column">
                        <h3>学生组志愿数据</h3>
                        <pre id="studentPrefData">无数据</pre>
                    </div>
                    <div class="data-column">
                        <h3>老师选择数据</h3>
                        <pre id="teacherPrefData">无数据</pre>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>2. 模拟数据生成</h2>
            <p>生成模拟数据以测试管理员页面显示功能</p>
            <button id="generateMockData">生成模拟学生组志愿和老师选择数据</button>
            <button id="clearMockData" class="danger-btn">清除所有模拟数据</button>
            <div id="mockDataStatus" class="result" style="display: none;">
                <pre id="mockDataResult">操作结果将显示在这里</pre>
            </div>
        </div>
        
        <div class="test-section">
            <h2>3. 功能验证</h2>
            <p>修复完成后，您可以访问以下页面验证功能：</p>
            <ul>
                <li><a href="student.html" target="_blank">学生页面</a> - 测试导师选择功能</li>
                <li><a href="teacher.html" target="_blank">老师页面</a> - 测试学生组选择功能</li>
                <li><a href="admin.html" target="_blank">管理员页面</a> - 验证数据显示</li>
            </ul>
        </div>
    </div>
    
    <script>
        // 检查数据流程状态
        document.getElementById('checkDataFlow').addEventListener('click', function() {
            const statusMessages = [];
            let hasError = false;
            
            // 检查localStorage中的数据
            const studentPrefData = localStorage.getItem('studentPreferencesData');
            const teacherPrefData = localStorage.getItem('teacherPreferencesData');
            const teamsData = localStorage.getItem('teamsData');
            const teachersData = localStorage.getItem('teachersData');
            
            // 状态检查
            if (!studentPrefData) {
                statusMessages.push('<div class="status-message message-warning"><span class="status-indicator status-warning"></span>未找到学生组志愿数据(studentPreferencesData)</div>');
            } else {
                try {
                    const data = JSON.parse(studentPrefData);
                    statusMessages.push(`<div class="status-message message-success"><span class="status-indicator status-success"></span>已找到学生组志愿数据，共${data.length}条记录</div>`);
                } catch (e) {
                    statusMessages.push('<div class="status-message message-error"><span class="status-indicator status-error"></span>学生组志愿数据格式错误</div>');
                    hasError = true;
                }
            }
            
            if (!teacherPrefData) {
                statusMessages.push('<div class="status-message message-warning"><span class="status-indicator status-warning"></span>未找到老师选择数据(teacherPreferencesData)</div>');
            } else {
                try {
                    const data = JSON.parse(teacherPrefData);
                    statusMessages.push(`<div class="status-message message-success"><span class="status-indicator status-success"></span>已找到老师选择数据，共${data.length}条记录</div>`);
                } catch (e) {
                    statusMessages.push('<div class="status-message message-error"><span class="status-indicator status-error"></span>老师选择数据格式错误</div>');
                    hasError = true;
                }
            }
            
            if (!teamsData) {
                statusMessages.push('<div class="status-message message-warning"><span class="status-indicator status-warning"></span>未找到团队数据(teamsData)</div>');
            }
            
            if (!teachersData) {
                statusMessages.push('<div class="status-message message-warning"><span class="status-indicator status-warning"></span>未找到教师数据(teachersData)</div>');
            }
            
            // 显示状态信息
            document.getElementById('statusMessages').innerHTML = statusMessages.join('');
            
            // 显示数据预览
            document.getElementById('studentPrefData').textContent = studentPrefData || 'localStorage中没有studentPreferencesData';
            document.getElementById('teacherPrefData').textContent = teacherPrefData || 'localStorage中没有teacherPreferencesData';
            
            document.getElementById('dataFlowStatus').style.display = 'block';
        });
        
        // 生成模拟数据
        document.getElementById('generateMockData').addEventListener('click', function() {
            // 生成模拟团队数据
            const mockTeams = [
                { id: 'team1', name: '创新小组', leaderId: 'student1', members: ['student1', 'student2'], direction: '人工智能' },
                { id: 'team2', name: '数据科学团队', leaderId: 'student3', members: ['student3', 'student4'], direction: '大数据分析' },
                { id: 'team3', name: '前端开发组', leaderId: 'student5', members: ['student5', 'student6'], direction: 'Web前端' }
            ];
            
            // 生成模拟教师数据
            const mockTeachers = [
                { id: 'teacher1', name: '张教授', title: '教授', major: '计算机科学', research: '人工智能' },
                { id: 'teacher2', name: '李副教授', title: '副教授', major: '软件工程', research: '软件工程' },
                { id: 'teacher3', name: '王讲师', title: '讲师', major: '数据科学', research: '大数据' }
            ];
            
            // 生成模拟学生组志愿数据
            const mockStudentPrefs = [
                { teamId: 'team1', preferences: ['teacher1', 'teacher2', 'teacher3'], submitDate: '2024-01-20' },
                { teamId: 'team2', preferences: ['teacher3', 'teacher1', 'teacher2'], submitDate: '2024-01-21' },
                { teamId: 'team3', preferences: ['teacher2', 'teacher3', 'teacher1'], submitDate: '2024-01-22' }
            ];
            
            // 生成模拟老师选择数据
            const mockTeacherPrefs = [
                { teacherId: 'teacher1', selectedGroups: ['team1', 'team2', 'team3'], submitDate: '2024-01-20' },
                { teacherId: 'teacher2', selectedGroups: ['team2', 'team1', 'team3'], submitDate: '2024-01-21' },
                { teacherId: 'teacher3', selectedGroups: ['team3', 'team2', 'team1'], submitDate: '2024-01-22' }
            ];
            
            // 保存到localStorage
            localStorage.setItem('teamsData', JSON.stringify(mockTeams));
            localStorage.setItem('teachersData', JSON.stringify(mockTeachers));
            localStorage.setItem('studentPreferencesData', JSON.stringify(mockStudentPrefs));
            localStorage.setItem('teacherPreferencesData', JSON.stringify(mockTeacherPrefs));
            
            // 显示结果
            const result = {
                message: '模拟数据生成成功！',
                teams: mockTeams.length,
                teachers: mockTeachers.length,
                studentPreferences: mockStudentPrefs.length,
                teacherPreferences: mockTeacherPrefs.length
            };
            
            document.getElementById('mockDataResult').textContent = JSON.stringify(result, null, 2);
            document.getElementById('mockDataStatus').style.display = 'block';
            
            alert('模拟数据生成成功，请刷新管理员页面查看显示效果！');
        });
        
        // 清除所有模拟数据
        document.getElementById('clearMockData').addEventListener('click', function() {
            if (confirm('确定要清除所有模拟数据吗？')) {
                localStorage.removeItem('studentPreferencesData');
                localStorage.removeItem('teacherPreferencesData');
                localStorage.removeItem('teamsData');
                localStorage.removeItem('teachersData');
                localStorage.removeItem('studentsData');
                
                document.getElementById('mockDataResult').textContent = '已清除所有模拟数据';
                document.getElementById('mockDataStatus').style.display = 'block';
                alert('所有模拟数据已清除！');
            }
        });
    </script>
</body>
</html>